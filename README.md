# Documents Viewer

## Скриншоты реализации

![1.png](1.png)

## Ссылка на приложение

[Ссылка на github-pages]()

### Описание решения

- Используется виртуальный скролл (CDK virtual scroll). Без него как будто легче взять стандартные document viewer.
- Используется custom virtual scroll strategy для поддержки страниц любого размера.
  Сейчас размеры получются из первых 32 bytes (Range: 'bytes=0-32') png формата.
  Лучше чтобы размер страниц сразу приходил из апи.
  <span style="color:#d15704">Минусы: нужно считать размер на бекенде и грузить сразу все размеры.В png метаинформации может и не быть.</span>
- Для zoom увеличиваю размер страниц + маштабирую offset scrollbar чтобы не было сдвига.
- Для каждой страницы создаю невидимый слой аннотации. Размер и позицию аннотаций рассчитываю в процентах для скалирования.
<span style="color:#d15704"> Минусы: Проценты недостаточно точны, может быть погрешность в округлениях.</span>
- Для аннотации создал CVA для измения значения контрола при изменение положения (cdk-drag-drop).
<span style="color:#d15704"> Нельзя разместить аннотацию между страницами.</span>
- Для загрузки картинки использую диалог input file + drag and drop + [readDataUrlAsImage](https://github.com/daniilmaslof/document-viewer/blob/master/projects/common/src/lib/core/utils/rxjs/read-data-url-as-image.ts).
  <span style="color:#d15704">Минусы: Пользователь не видит сразу результат. Можно будет добавить cropper c отоброжением страницы в диалоге</span>
- Для сохранения создал форму следующего формата.
  ![2.png](2.png)
<span style="color:#d15704"> Минусы: Все кроме аннотаций может и не менятся и можно было создать просто formArray для аннотаций.</span>
- Для скалирования font-size и кнопки удаления использую --scale-factor переменую.

### Известные проблемы

- Решил проблему со сдвигом viewport направо когда приходит широкая страница. Считаем максимальную ширину документа и зарание добавляем горизонтальный скролл.
- Квадрирование если в документе много страниц А0 формата то логично сразу заскейлить все страницы под viewport. Решение вычислять squareFactor. Пока закоментировал фикс для этого.
- Из за templateCacheSize в virtual scroll и смешение аннотаций при scale пришлось сделать компонент аннотации зависимым от zoomService для markForCheck. Чтобы аннотации не смешались.
- Проблема загрузка полноразмерных картинок в page, annotations.
- Решение добавить placeholder в base64 или грузить изображение плохого качество, а потом грузить изображение лучшего качества, например при scale или остановке прокрутки.
- Скалирование на мобилке может потребовать дополнительного решения. Решение добавить что то типо tuiZoom.
